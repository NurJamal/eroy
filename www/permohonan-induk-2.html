<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">

		<!--<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, maximum-scale=1">-->	
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />				<link rel="stylesheet" href="css/bootstrap.min.css">


		<link rel="stylesheet" type="text/css" href="css/header.css" />
		<link rel="stylesheet" type="text/css" href="css/body.css" />
		<link rel="stylesheet" type="text/css" href="css/color_icon.css">
		<link rel="stylesheet" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/jquery-confirm.css" />
		<link rel="stylesheet" href="css/jquery-confirm.less" />
		<link type="text/css" rel="stylesheet" href="css/waitMe.css">
		<link type="text/css" rel="stylesheet" href="js/jquery.qtip.css" />

		<div id="scrollTop" >
			<img src="img/up_arrow.png" class="scrolltop_arrow"/>		
		</div>	
	</head>
	<body>	
	
	<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
	
	<!-- slide menu right -->
	<div id="navigation"></div>
	<!-- end of slide menu right -->
	
	<!-- header -->

	<div id="head">
		<img src="img/logo-atas.png" class="logo"/>
		<img src="img/menu-icon.png" class="toggle-slide-right menu_icon" align="right"/>
		<a href="" onclick="goBack()"><img src="img/back-icon.png" class="back_icon" align="left"/></a>
	</div>	

	<!-- end of header -->

	<div class="containerBlock">

		<!-- header title -->

		<div class="content_title">
			<div class="input-group add-on search-box">
				<div class="input-group-btn">
					<h1 class="main_title">PERMOHONAN INDUK</h1>
				</div>
			</div>	
		</div>

		<!-- end of header-title-->
	
		<div id="content">	
			<!-- navbar -->

			<div class="navbar">
				<div align="center">
					<img src="img\numbering-ppb05-2.png" style="width:100%;height:auto"/>
				</div>	
			</div>

			<!-- end of navbar -->
	
			<!-- form -->
	
			<div class="_form">
				<form action="" name="pendaftaran" id="pendaftaran">
					<div>
						<h5 id="_orange_title">Nama Pertubuhan</h5>
						<h1 class="_dark_text" id="nama_pendaftaran_bercawangan"></h1><br/>
						<input type="hidden" value="" name="id_pertubuhan" id="id_pertubuhan">
					</div>

					<h5 id="_orange_title">Alamat Tempat Urusan</h5>
						<input type="text" name="alamat1" id="alamat1" placeholder="Alamat 1"><br/>
						<input type="text" name="alamat2" id="alamat2" placeholder="Alamat 2"><br/>
						<input type="text" name="alamat3" id="alamat3" placeholder="Alamat 3"><br/>
						<input type="text" name="poskod" id="poskod" placeholder="Poskod"><br/>
					
					<div class="selection" id="negeri_selection">
						<h5 id="_orange_title">Negeri</h5>
							<select id="sel_negeri" name="sel_negeri" class="_sel" onchange="getDaerahFromSelectedCountry()">
								<option value="" selected>Pilih Negeri</option>
							</select>
					</div>
					
					<div class="selection" id="daerah_selection">
						<h5 id="_orange_title">Daerah</h5>
							<select id="sel_daerah" name="sel_daerah" class="_sel">
								<option value="" selected>Pilih Daerah</option>
							</select>
					</div>
					<br/>
					
					<h5 id="_orange_title">Alamat Pos</h5>
						<h6>
							<input type="checkbox" name="alamat_sama" id="c_box1" class="checkboxClass" onclick="salinAlamat(this.form)"> 
							<label for="c_box1">Klik jika alamat sama seperti di atas.</label>
						</h6>
					
						<input type="text" name="alamat1Pos" id="alamat1Pos" placeholder="Alamat 1"><br/>
						<input type="text" name="alamat2Pos" id="alamat2Pos" placeholder="Alamat 2"><br/>
						<input type="text" name="alamat3Pos" id="alamat3Pos" placeholder="Alamat 3"><br/>
						<input type="text" name="poskodPos" id="poskodPos" placeholder="Poskod"><br/>
					
					<div class="selection" id="negeripos_selection">
						<h5 id="_orange_title">Negeri</h5>
							<select id="sel_negeriPos" name="sel_negeriPos" class="_sel" onchange="getDaerahFromSelectedCountryPos()">
								<option value="">Pilih Negeri</option>
							</select>
					</div>
					
					<div class="selection" id="daerahpos_selection">
						<h5 id="_orange_title">Daerah</h5>
							<select id="sel_daerahPos" name="sel_daerahPos" class="_sel">
								<option value="">Pilih Daerah</option>
							</select>	
					</div>	

					<div class="default_button_holder">
						<a href="permohonan-induk-3.html"><input class="default_button" type="button" value="SIMPAN" id="btn_submit"></a>
					</div>
				</form>
			</div>

			<!-- end of form -->

		</div>			
	</div>
	
	<!-- js for slide menu -->
	<script src="js/classie.js"></script>
	<script src="js/nav.js"></script>
	
	<script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
	<script src="js/jquery-1.9.1.min.js" type="text/javascript" language="javascript"></script>
	<script src="js/jquery.xml2json.js" type="text/javascript" language="javascript"></script>

	<!-- Scroll To Top (Add tag a header for all page) Import js/internal/custom.js-->
	<script src="js/internal/custom.js" type="text/javascript" language="javascript"></script>

	<!-- alert box -->
	<script src="js/jquery-confirm.js"></script>
	<script src="js/jquery-confirm.min.js"></script>	
	
	<!--Loading Indicator -->
	<script src="js/waitMe.js"></script>

	<script type="text/javascript" src="js/jquery.qtip.js"></script>

	<script>
		/*PAPARKAN NAMA PERSATUAN DARI FORM SEBELUM*/
		$('#nama_pendaftaran_bercawangan').html(window.localStorage.getItem("NAMA_PENDAFTARAN_BERCAWANGAN"));

		getCountry($('#sel_negeri').attr('id'),'');
		getCountry($('#sel_negeriPos').attr('id'),'');

		/*GET DATA FROM SERVER - IF USER DATA ALREADY EXIST*/
		var kad_pengenalan = window.localStorage.getItem('LOGIN');
		var status = window.localStorage.getItem('STATUS');

		if(status == "kuiri")
		{
			var insertData = "kuiriUpdate";
			var kod_pertubuhan = window.localStorage.getItem('KUIRI_KOD_PERTUBUHAN');
			formLength = document.pendaftaran.elements.length;

			$(function() 
			{
				$.ajax({
					url:"http://eroy.me-tech.com.my/api/pendaftaran/pendaftaran_bercawangan_2.php",
					type:'POST',
					data: {
						kad_pengenalan : kod_pertubuhan,
						insertData : "kuiri"

					},
					beforeSend: function() {
							run_waitMe();
					},
					success:function(data){
						var json = $.xml2json(data);
						console.log(json);
						if (json.status == 'SELECT') {
							for (var i = 0; i < formLength; i++) {
								if(document.pendaftaran.elements[i].type != 'button')
								{
									document.pendaftaran.elements[i].setAttribute("disabled", "disabled"); 	
								}

								if(document.pendaftaran.elements[i].type == 'checkbox')
								{
									document.pendaftaran.elements[i].setAttribute("checked", "checked"); 
								}
							};
							$("#id_pertubuhan").val(json.details.kod_nama_pertubuhan);
							$("#alamat1").val(json.details.alamat1);
							$("#alamat2").val(json.details.alamat2);
							$("#alamat3").val(json.details.alamat3);
							$("#poskod").val(json.details.poskod);

							getCountry($('#sel_negeri').attr('id'),json.details.negeri);	
							getDaerah(json.details.negeri,$('#sel_daerah').attr('id'),json.details.daerah);	
							
							$("#alamat1Pos").val(json.details.alamat_pos1);
							$("#alamat2Pos").val(json.details.alamat_pos2);
							$("#alamat3Pos").val(json.details.alamat_pos3);
							$("#poskodPos").val(json.details.poskod_pos);

							getCountry($('#sel_negeriPos').attr('id'),json.details.negeri_pos);	
							getDaerah(json.details.negeri_pos,$('#sel_daerahPos').attr('id'),json.details.daerah_pos);	
							checkKuiriPendaftaran(kod_pertubuhan,'2');

							$('body').waitMe('hide');
						}
						else if (json.status == 'VIEW') {
						//Do nothing. Just display
						
					}
					
					$('body').waitMe('hide');
					}
				});
			});
		}else
		{
			var insertData = "TRUE";
			$(function() 
			{
				$.ajax({
					url:"http://eroy.me-tech.com.my/api/pendaftaran/pendaftaran_bercawangan_2.php",
					type:'POST',
					data: {
						kad_pengenalan : kad_pengenalan,
						insertData : "select"

					},
					beforeSend: function() {
							run_waitMe();
					},
					success:function(data){
						var json = $.xml2json(data);
						console.log(json);
						if (json.status == 'SELECT') {
							$("#alamat1").val(json.details.alamat1);
							$("#alamat2").val(json.details.alamat2);
							$("#alamat3").val(json.details.alamat3);
							$("#poskod").val(json.details.poskod);

							getCountry($('#sel_negeri').attr('id'),json.details.negeri);	
							getDaerah(json.details.negeri,$('#sel_daerah').attr('id'),json.details.daerah);	
							
							$("#alamat1Pos").val(json.details.alamat_pos1);
							$("#alamat2Pos").val(json.details.alamat_pos2);
							$("#alamat3Pos").val(json.details.alamat_pos3);
							$("#poskodPos").val(json.details.poskod_pos);

							getCountry($('#sel_negeriPos').attr('id'),json.details.negeri_pos);	
							getDaerah(json.details.negeri_pos,$('#sel_daerahPos').attr('id'),json.details.daerah_pos);	

							$('body').waitMe('hide');
						}
						else if (json.status == 'VIEW') {
						//Do nothing. Just display
						
					}
					
					$('body').waitMe('hide');
					}
				});
			});
		}

		function getDaerahFromSelectedCountry()  
		{
			var selected_country = $('#sel_negeri').val();
			getDaerah(selected_country,$('#sel_daerah').attr('id'),'');	
		}

		function getDaerahFromSelectedCountryPos()  
		{
			var selected_country = $('#sel_negeriPos').val();
			getDaerah(selected_country,$('#sel_daerahPos').attr('id'),'');	
		}

		function salinAlamat(f) 
		{
			if(f.alamat_sama.checked == true) 
			{	
				var alamat1 = $("#alamat1").val();
				$("#alamat1Pos").val(alamat1);
				
				var alamat2 = $("#alamat2").val();
				$("#alamat2Pos").val(alamat2);
					
				var alamat3 = $("#alamat3").val();
				$("#alamat3Pos").val(alamat3);
					
				var poskod = $("#poskod").val();
				$("#poskodPos").val(poskod);
					
				var negeri = $("#sel_negeri").val();
				$("#sel_negeriPos").val(negeri);

				var daerah = $("#sel_daerah").val();
				//if copy address from main address. auto retrieve daerah
				getDaerah(negeri,$('#sel_daerahPos').attr('id'),daerah);
				
				//if copy address from main address. auto retrieve daerah
				//getDaerahFromSelectedCountryPos(); 		
					
			}	
			else
			{
					$('#alamat1Pos, #alamat2Pos, #alamat3Pos, #poskodPos, #sel_negeriPos, #sel_daerahPos').val('');
			}
		}

		$("#btn_submit").click(function(e){
			redisplayHeader();
			var empty = false;
			e.preventDefault();
			//NEED TO CREATE ONE GLOBAL FUNCTION FOR THIS VALIDATION - Change border css
			$('#alamat1,#alamat1Pos,#poskod,#poskodPos,#negeripos_selection,#daerahpos_selection,#negeri_selection,#daerah_selection').css({"border":"","box-shadow":""});

			var id_pertubuhan = $("#id_pertubuhan").val();
			var alamat1= $("#alamat1").val();
			var alamat2 = $("#alamat2").val();
			var alamat3 = $("#alamat3").val();
			var sel_negeri = $("#sel_negeri").val();
			var sel_daerah = $("#sel_daerah").val();
			var poskod= $("#poskod").val();
			var nama_pertubuhan = window.localStorage.getItem("NAMA_PENDAFTARAN_BERCAWANGAN");
			var alamat_pos1= $("#alamat1Pos").val();
			var alamat_pos2 = $("#alamat2Pos").val();
			var alamat_pos3 = $("#alamat3Pos").val();
			var sel_negeripos = $("#sel_negeriPos").val();
			var sel_daerahpos = $("#sel_daerahPos").val();
			var poskod_pos= $("#poskodPos").val();

			//NEED TO CREATE ONE GLOBAL FUNCTION FOR THIS VALIDATION - validate empty fill
			if (alamat1.length == 0)
			{
				$('#alamat1').css({"border":"1px solid red","box-shadow":"0 0 3px #F22613"});
				empty = true;
			}
			if(sel_negeri.length == 0)
			{
				$('#negeri_selection').css({"border":"1px solid red","box-shadow":"0 0 3px #F22613"});
				empty = true;

			}
			if(sel_daerah.length == 0)
			{
				$('#daerah_selection').css({"border":"1px solid red","box-shadow":"0 0 3px #F22613"});
				empty = true;
			}
		
			if(alamat_pos1.length == 0)
			{
				$('#alamat1Pos').css({"border":"1px solid red","box-shadow":"0 0 3px #F22613"});
				empty = true;
			}
			if(sel_negeripos.length == 0)
			{
				$('#negeripos_selection').css({"border":"1px solid red","box-shadow":"0 0 3px #F22613"});
				empty = true;
			}
			if(sel_daerahpos.length == 0)
			{
				$('#daerahpos_selection').css({"border":"1px solid red","box-shadow":"0 0 3px #F22613"});
				empty = true;
			}
			if(poskod.length == 0)
			{
				$('#poskod').css({"border":"1px solid red","box-shadow":"0 0 3px #F22613"});
				empty = true;
			}
			if(poskod_pos.length == 0)
			{
				$('#poskodPos').css({"border":"1px solid red","box-shadow":"0 0 3px #F22613"});
				empty = true;
			}
			
			if(empty == true)
			{
				$.alert
				(
					{
						title: 'Perhatian',
						content: 'Sila isikan tempat kosong!',
						confirm: function(){				
						}
					}
				);
			}
			else if(empty == false)
			{
				if(id_pertubuhan == 'empty')
				{
					window.location.href = "permohonan-induk-3.html";
				}else
				{
					$.ajax({
						url:"http://eroy.me-tech.com.my/api/pendaftaran/pendaftaran_bercawangan_2.php",
						type:'POST',
						data: {

							alamat1 : alamat1,
							alamat2: alamat2,
							alamat3 : alamat3,
							sel_negeri : sel_negeri,
							sel_daerah : sel_daerah,
							poskod : poskod,
							alamat_pos1 : alamat_pos1,
							alamat_pos2 : alamat_pos2,
							alamat_pos3 : alamat_pos3,
							sel_negeripos : sel_negeripos,
							sel_daerahpos : sel_daerahpos,
							poskod_pos : poskod_pos,
							insertData : insertData,
							kad_pengenalan : kad_pengenalan,
							nama_pertubuhan : nama_pertubuhan,
							id_pertubuhan : id_pertubuhan,
						},
						beforeSend: function() {
								run_waitMe();
						},
						success:function(data){
							console.log(data);
							var json = $.xml2json(data);
							console.log(json);
							if (json.status == 'ok') {
								
								$.alert
								(
									{
										title: 'Status',
										content: json.message,
										confirm: function(){
											window.location.href = "permohonan-induk-3.html";
										}
									}
								);
							
							}
							else if (json.status == 'error') {
								$.alert
								(
									{
										title: 'Status',
										content: json.message,
										confirm: function(){
										}
									}
								);
							}
							else{}
							$('body').waitMe('hide');
						}
					});
				}
			}
		});
	</script>
	</body>
</html>